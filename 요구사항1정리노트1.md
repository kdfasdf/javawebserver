## 요구사항 1-1 - http://localhost:8080/index.html로 접속시 응답

웹에서 클라이언트가 주소창에 특정 도메인이나 IP를 입력하면  특정 도메인에 대응되는 IP주소를 찾아
특정 서버와 브라우저를 연결한다.
만약 주소창에 http://임의의이름/index.html을 치면 아래 같은 http 요청 메시지를 보내게 된다

- http 요청 메시지
  - header
    <br>
  
    ```
    GET /index.html HTTP/1.1
    HOST 임의의 이름
    Connection: keep-alive
    Accept : */*
    ...
    ```
  - body
    - 없음

  <br>
  
클라이언트는 해당 요청에 대한 응답을 서버로 부터 받는다
- http 응답 메시지
  - header
    <br>
    ```
    HTTP 1.1 200 OK
    Last - modified : ....
    content - length : ...
    content type : text/html
    ...
    ```
  - body
    ```
    <HTML>
    ...
    </HTML>
    ```
    
![image](https://github.com/kdfasdf/javawebserver/assets/96770726/dd489473-22d0-4cc2-b37b-6c200b0b43be)

1. 해당 요구사항에 대해서 동작을 수행하는 코드는 Webserver.java와 RequestHandler.java이다.
2. 실행할 때 매개변수로 받은 숫자가 있다면 그 숫자를 포트번호로 사용하고 아니면 8080을 기본 포트로 사용한다
3. WebServer에서 클라이언트와 연결될 때 까지 기다렸다가 연결 되면 requestHandler를 통해 클라이언트로 응답을 보낸다
4. localhost/index.html에서 index.html을 얻는 코드는 HttpRequestUtils에 getUrl메서드를 구현 하였다.
- WebServer.java
```
package webserver;

import org.slf4j.LoggerFactory;
import org.slf4j.Logger;

import java.net.ServerSocket;
import java.net.Socket;

public class WebServer {
    private static final Logger log = LoggerFactory.getLogger(WebServer.class);
    public static final int DEFAULT_PORT=8080;
    public static void main(String args[]) throws Exception{
        int port =0;
        if(args==null||args.length==0){ //실행 시 매개변수가 없으면
            port=DEFAULT_PORT;
        }
        else{
            port=Integer.parseInt(args[0]);  //실행 시 매개변수가 있는 경우
        }
        try(ServerSocket listenSocket = new ServerSocket(port)){
            log.info("Web Application Server started {} port",port);
            Socket connection;

            // 클라이언트와 서버가 연결될 때 까지 기다리고
            // 연결되면 IP주소를 매개변수로 RequestHandler로 동작한다.
            while((connection = listenSocket.accept())!=null){
                RequestHandler requestHandler=new RequestHandler(connection);
                requestHandler.start();
            }
        }

    }
}
```

- RequestHandler.java
```
package webserver;

import java.io.*;
import java.net.Socket;
import java.nio.file.Files;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import util.HttpRequestUtils;

public class RequestHandler extends Thread {
    private static final Logger log = LoggerFactory.getLogger(RequestHandler.class);

    private Socket connection;

    public RequestHandler(Socket connectionSocket) {
        this.connection = connectionSocket;
    }

    public void run() {
        log.debug("New Client Connect! Connected IP : {}, Port : {}", connection.getInetAddress(),
                connection.getPort());
        try (InputStream in = connection.getInputStream(); OutputStream out = connection.getOutputStream()) {
            InputStreamReader isr = new InputStreamReader(in,"UTF-8");
            BufferedReader br = new BufferedReader(isr);
            String url = HttpRequestUtils.getUrl(br.readLine());
            DataOutputStream dos = new DataOutputStream(out);
            byte[] body = Files.readAllBytes(new File("./webapp"+url).toPath());
            response200Header(dos, body.length);
            responseBody(dos, body);
        } catch (IOException e) {
            log.error(e.getMessage());
        }
    }

    private void response200Header(DataOutputStream dos, int lengthOfBodyContent) {
        try {
            dos.writeBytes("HTTP/1.1 200 OK \r\n");
            dos.writeBytes("Content-Type: text/html;charset=utf-8\r\n");
            dos.writeBytes("Content-Length: " + lengthOfBodyContent + "\r\n");
            dos.writeBytes("\r\n");
        } catch (IOException e) {
            log.error(e.getMessage());
        }
    }

    private void responseBody(DataOutputStream dos, byte[] body) {
        try {
            dos.write(body, 0, body.length);
            dos.flush();
        } catch (IOException e) {
            log.error(e.getMessage());
        }
    }
}

```

- HttpRequestUtils.java
```
package util;

import java.util.stream.Collectors;

import com.google.common.base.Strings;
import com.google.common.collect.Maps;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class HttpRequestUtils {
    /**
     * @param queryString은
     *            URL에서 ? 이후에 전달되는 field1=value1&field2=value2 형식임
     * @return
     */
    public static Map<String, String> parseQueryString(String queryString) {
        return parseValues(queryString, "&");
    }

    /**
     * @param 쿠키
     *            값은 name1=value1; name2=value2 형식임
     * @return
     */

    public static final Logger log = LoggerFactory.getLogger(HttpRequestUtils.class);
    public static String getUrl(String firstLine){
        String [] splited = firstLine.split(" ");
        String path = splited[1];
        log.debug("request path : {}",path);
        return path;
    }
   
        @Override
        public String toString() {
            return "Pair [key=" + key + ", value=" + value + "]";
        }
    }
}

```

